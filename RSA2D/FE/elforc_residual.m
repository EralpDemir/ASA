function [fe] = elforc_residual(nnpe,nqptv,wtq,sfac,detj,crystal_stress)% computes elemental force matrix for body forcesndofnp = 3;% numdim = 2;% nnpe2 = 2*nnpe; iend1 =   nnpe*ndofnp;% sfac_sig       = zeros(1,nnpe);% sfac_onedof    = zeros(1,nnpe);sfac_3dof    = zeros(ndofnp,iend1);qp_stress      = zeros(ndofnp,1);fe      = zeros(iend1,1);                                                               for   k=1:1:nqptv        xkfac= wtq(k)*detj(k);    qp_stress(1) = crystal_stress(1,k);    qp_stress(2) = crystal_stress(2,k);    qp_stress(3) = crystal_stress(3,k);%     for  i=1:1:nnpe %       sfac_onedof(i)  = sfac(i,k);%     end  %     for  i=1:1:ndofnp %         for j = 1:1:nnpe%             j1=(i-1)*nnpe+j;%             sfac_3dof(i,j1)  = sfac_onedof(j);%         end%     end     %   for  i=1:1:ndofnp %       for j = 1:1:nnpe%           j1=(j-1)*ndofnp+i;%           sfac_3dof(i,j1)  = sfac_onedof(j);%       end%   end     %     sfac_3dof = [   sfac(1,k), 0, 0, sfac(2,k), 0, 0, sfac(3,k), 0, 0, sfac(4,k), 0, 0;%                     0, sfac(1,k), 0, 0, sfac(2,k), 0, 0, sfac(3,k), 0, 0, sfac(4,k), 0;%                     0, 0, sfac(1,k), 0, 0, sfac(2,k), 0, 0, sfac(3,k), 0, 0, sfac(4,k);];%                       for  i=1:1:ndofnp          for j = 1:1:nnpe              j1=(j-1)*ndofnp+i;              sfac_3dof(i,j1)  = sfac(j,k);          end      end          fe = fe  + xkfac*sfac_3dof' * qp_stress;   end