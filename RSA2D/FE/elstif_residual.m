function [se,ce,qe] = elstif_residual(nnpe,nqptv,wtq,sfac,dndx,dndy,detj)% forms elemental stiffness matrix ndofnp = 3;numdim = 2;% nnpe2 = 2*nnpe; iend1 =   nnpe*ndofnp;mdofnp      = zeros(iend1,iend1);qe      = zeros(iend1,ndofnp);equil_con   = zeros(iend1,iend1);% BMAT = zeros(numdim,iend1);                                                               for   k=1:1:nqptv        xkfac= wtq(k)*detj(k);                  %     sfac_onedof    = zeros(1,nnpe);    sfac_3dof    = zeros(ndofnp,iend1);%     for  i=1:1:nnpe %         sfac_onedof(i)  = sfac(i,k);%     end%   %   % %   for  i=1:1:ndofnp %       for j = 1:1:nnpe%           j1=(j-1)*ndofnp+i;%           sfac_3dof(i,j1)  = sfac_onedof(j);%       end%   end   %           for  i=1:1:ndofnp          for j = 1:1:nnpe              j1=(j-1)*ndofnp+i;              sfac_3dof(i,j1)  = sfac(j,k);          end      end    mdofnp = mdofnp + xkfac*(sfac_3dof'*sfac_3dof);        qe = qe + xkfac*(sfac_3dof');    bmatrix     = zeros(numdim,iend1); %     for i = 1:1:nnpe% % %         bmatrix(1,i)       = dndx(i,k);%         bmatrix(1,i+nnpe)  = 0;%         bmatrix(1,i+nnpe2) = dndy(i,k);%         bmatrix(2,i)       = 0;%         bmatrix(2,i+nnpe)  = dndy(i,k);%         bmatrix(2,i+nnpe2) = dndx(i,k);% %     end      %     %     bmatrix = [ dndx(1,k), 0, dndy(1,k),  dndx(2,k), 0, dndy(2,k), dndx(3,k), 0, dndy(3,k), dndx(4,k), 0, dndy(4,k); %                  0, dndy(1,k), dndx(1,k),  0, dndy(2,k), dndx(2,k), 0, dndy(3,k), dndx(3,k), 0, dndy(4,k), dndx(4,k);]; %         for i = 1:1:nnpe        j1=(i-1)*ndofnp;                bmatrix(1,j1+1) = dndx(i,k);        bmatrix(1,j1+2) = 0;        bmatrix(1,j1+3) = dndy(i,k);                bmatrix(2,j1+1) = 0;        bmatrix(2,j1+2) = dndy(i,k);        bmatrix(2,j1+3) = dndx(i,k);    end%     bmatrix_ = [ dndx(1,k), 0, dndy(1,k),  dndx(2,k), 0, dndy(2,k), dndx(3,k), 0, dndy(3,k), dndx(4,k), 0, dndy(4,k); %                 0, dndy(1,k), dndx(1,k),  0, dndy(2,k), dndx(2,k), 0, dndy(3,k), dndx(3,k), 0, dndy(4,k), dndx(4,k);]; % % %   %     BMAT = bmatrix_ + BMAT;        equil_con = equil_con +  xkfac*(bmatrix'*bmatrix);  endse = mdofnp ;ce = equil_con;                                                                    